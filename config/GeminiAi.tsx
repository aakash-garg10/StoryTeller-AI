const { GoogleGenerativeAI, HarmCategory, HarmBlockThreshold } = require("@google/generative-ai");

const apiKey = process.env.NEXT_PUBLIC_GEMINI_API_KEY;
const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
  model: "gemini-2.0-flash",
});

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 40,
  maxOutputTokens: 8192,
  responseMimeType: "application/json",
};

export const chatSession = model.startChat({
  generationConfig,
  history: [
    {
      role: "user",
      parts: [
        {
          text: "create kids story on  description for 5-8years kids, Educational story, and all images in 3D style: Story of boy and magic school , give me 5 chapters, with detailed image text prompt for each of chapter and image prompt for story c over book with story name, all in JSON field format",
        },
      ],
    },
    {
      role: "model",
      parts: [
        {
          text: 'Okay, I can help you create a JSON file containing a story for kids aged 5-8 about a boy and a magic school, divided into 5 chapters, with detailed 3D-style image prompts and a book cover prompt.\n\n```json\n{\n  "title": "The Adventures of Leo at Sparklewick Academy",\n  "target_age": "5-8 years",\n  "description": "Join Leo on his magical journey as he discovers Sparklewick Academy and learns incredible spells, makes amazing friends, and overcomes exciting challenges!",\n  "cover": {\n    "image_prompt": "Book cover illustration: A young boy, Leo (8 years old, bright eyes, messy brown hair, wearing a slightly-too-big blue wizard robe), stands excitedly in front of a grand, whimsical castle made of candy and stardust, Sparklewick Academy, surrounded by floating books and sparkling lights. The title \'The Adventures of Leo at Sparklewick Academy\' is written in large, playful, shimmering letters. 3D render, vibrant colors, whimsical style, Pixar-inspired.",\n    "alt_text": "Book cover for The Adventures of Leo at Sparklewick Academy showing Leo in front of a magical castle."\n  },\n  "chapters": [\n    {\n      "chapter_number": 1,\n      "chapter_title": "The Mysterious Invitation",\n      "text": "Leo was a normal boy who loved collecting colorful rocks. One sunny afternoon, a shimmering envelope appeared on his doorstep! It was an invitation to Sparklewick Academy, a school for young wizards. Leo couldn\'t believe his eyes! He packed his favorite rock and hopped on the magical bus waiting outside.",\n      "image": {\n        "image_prompt": "A young boy, Leo (8 years old, messy brown hair), stands on his doorstep, holding a shimmering golden envelope with a surprised expression. A magical, purple bus with giant, friendly-looking eyes and swirling patterns is waiting on the street. The house behind him is slightly cartoonish and cozy. 3D render, bright and cheerful colors, Pixar style.",\n        "alt_text": "Leo receiving an invitation to Sparklewick Academy."\n      }\n    },\n    {\n      "chapter_number": 2,\n      "chapter_title": "Welcome to Sparklewick!",\n      "text": "Sparklewick Academy was even more amazing than Leo imagined! The hallways were filled with floating books, and friendly creatures peeked out from behind every corner. He met Professor Bumble, a kind old wizard with a long white beard, who showed him to his room. His roommate was a girl named Maya, with bright purple hair and a mischievous grin.",\n      "image": {\n        "image_prompt": "Inside Sparklewick Academy: A grand hallway filled with floating books and glowing orbs. Leo (8 years old) stands next to Professor Bumble (a kind-looking wizard with a long white beard and a twinkle in his eye). A girl with bright purple hair, Maya, peeks out from behind a bookshelf, smiling mischievously. 3D render, fantasy setting, vibrant colors, highly detailed.",\n        "alt_text": "Leo arriving at Sparklewick Academy and meeting Professor Bumble and Maya."\n      }\n    },\n    {\n      "chapter_number": 3,\n      "chapter_title": "The First Spell",\n      "text": "Leo\'s first class was \'Sparkle Spells 101.\' Professor Bumble taught them how to make objects float. Leo tried his hardest, but his spell kept making his rock turn into a rubber chicken! Maya giggled, but she helped him focus. Finally, with a little bit of practice and a lot of concentration, Leo made his rock float! He was so proud!",\n      "image": {\n        "image_prompt": "Classroom scene: Leo (8 years old) is in \'Sparkle Spells 101\' class. His rock is floating slightly above his hand, but it also has rubber chicken features. Professor Bumble is smiling encouragingly, and Maya is offering helpful advice. Books and magical equipment are scattered around the classroom. 3D render, whimsical and humorous, bright colors.",\n        "alt_text": "Leo practicing his first spell in Sparkle Spells 101."\n      }\n    },\n    {\n      "chapter_number": 4,\n      "chapter_title": "The Lost Wand",\n      "text": "One day, Maya lost her wand! She was very upset, because her wand was a gift from her grandmother. Leo and Maya searched everywhere, but they couldn\'t find it. Suddenly, Leo remembered the small, dusty room at the end of the hallway. They ventured inside, and there it was, hidden behind a pile of old spell books!",\n      "image": {\n        "image_prompt": "Leo and Maya are searching in a dusty, forgotten room inside Sparklewick Academy. The room is filled with old spell books, cobwebs, and strange magical artifacts. Maya looks worried, while Leo is pointing excitedly towards a wand hidden behind a pile of books. 3D render, slightly darker lighting, mysterious atmosphere.",\n        "alt_text": "Leo and Maya searching for Maya\'s lost wand."\n      }\n    },\n    {\n      "chapter_number": 5,\n      "chapter_title": "Friendship and Magic",\n      "text": "Maya was so happy to have her wand back! She and Leo celebrated by practicing their spells together. They learned that magic was even better when shared with a friend. From that day on, Leo and Maya continued their magical adventures at Sparklewick Academy, always helping each other and having lots of fun. And Leo\'s rock? Well, it occasionally turned into a rubber chicken, but they learned to laugh about it.",\n      "image": {\n        "image_prompt": "Leo and Maya are standing side-by-side in the Sparklewick Academy courtyard, wands in hand, practicing spells together. Sparkles and magical effects surround them. Leo\'s rock is briefly transforming into a rubber chicken and then back again, making them laugh. The academy towers in the background. 3D render, warm and cheerful colors, magical atmosphere.",\n        "alt_text": "Leo and Maya practicing magic together at Sparklewick Academy."\n      }\n    }\n  ]\n}\n```\n\nExplanation:\n\n*   **JSON Structure:** The code is structured as a JSON object.\n*   **Top-Level Keys:**\n    *   `title`:  The title of the story.\n    *   `target_age`: The suggested age range for the story.\n    *   `description`: A brief summary of the story.\n    *   `cover`:  Contains the image prompt for the book cover.\n    *   `chapters`: An array of chapter objects.\n*   **Chapter Structure:** Each chapter object has:\n    *   `chapter_number`: The chapter number.\n    *   `chapter_title`: The title of the chapter.\n    *   `text`: The story text for that chapter.\n    *   `image`: An object containing:\n        *   `image_prompt`: A detailed prompt for generating an image for that chapter in a 3D style. The prompts try to be very specific about the characters, setting, and mood.  They also reference "Pixar style" to suggest a particular 3D aesthetic.\n        *   `alt_text`: Alternative text for the image, useful for accessibility.\n\nKey Improvements and Considerations:\n\n*   **Detailed Image Prompts:** The image prompts are designed to be very descriptive, helping the AI generate images consistent with the story\'s tone and style.\n*   **3D Style:** The prompts explicitly request a 3D rendered image in a Pixar-inspired style. This gives a visual direction.\n*   **Educational Aspect:** The story emphasizes friendship, perseverance, and helping others, which are valuable lessons for young children.\n*   **Whimsical Elements:** The story contains whimsical elements like a school made of candy and stardust, floating books, and rocks turning into rubber chickens to keep children entertained.\n*   **Alt Text:**  `alt_text` is included for each image to enhance accessibility.\n*   **JSON Format:** The output is in a valid JSON format, making it easy to parse and use programmatically.\n*   **Story Arc:** The story has a clear beginning, rising action, climax, and resolution, making it engaging for young readers.\n\nHow to use this JSON:\n\n1.  **Save as a `.json` file:**  Copy the code above and save it as a file named something like `leo_and_sparklewick.json`.\n2.  **Use a JSON parser:**  You can use a programming language like Python or JavaScript to read and process the JSON data.  For example, in Python:\n\n```python\nimport json\n\nwith open(\'leo_and_sparklewick.json\', \'r\') as f:\n    data = json.load(f)\n\nprint(data[\'title\']) # Output: The Adventures of Leo at Sparklewick Academy\nfor chapter in data[\'chapters\']:\n    print(f"Chapter {chapter[\'chapter_number\']}: {chapter[\'chapter_title\']}")\n    print(chapter[\'text\'])\n    print(f"Image Prompt: {chapter[\'image\'][\'image_prompt\']}")\n    print(f"Alt Text: {chapter[\'image\'][\'alt_text\']}")\n```\n\nThis will print out the story, chapter by chapter, along with the image prompts.  You can then use these image prompts with an appropriate AI image generation tool (while remembering that I cannot generate the images myself at this time).\n',
        },
      ],
    },
  ],
});
